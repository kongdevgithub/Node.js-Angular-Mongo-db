<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="robots" content="noindex, nofollow">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A fully featured admin theme which can be used to build CRM, CMS, etc.">
    <meta name="author" content="Coderthemes">
    <link rel="shortcut icon" href="assets/images/favicon.ico">

    <title>Adminto - Responsive Admin Dashboard Template</title>

    <!--Morris Chart CSS -->
    <link rel="stylesheet" href="assets/plugins/morris/morris.css">

    <!-- fontawesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="bower_components/angular-material/angular-material.min.css">
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css">

    <!-- App css -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/core.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/components.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/icons.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/pages.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/menu_dark.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/responsive.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="bower_components/angular-ui-grid/ui-grid.min.css"/>
    <link rel="stylesheet" href="bower_components/sweetalert/dist/sweetalert.css">

    <!-- HTML5 Shiv and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https//://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="assets/js/modernizr.min.js"></script>
</head>

<body ng-app="myApp">

    <div id="wrapper">

        <div class="content" style="margin-top: 15px;">
            <!-- Start content -->
            <div class="container" ng-controller="myCtrl">

                <div class="row">
                    <div class="col-sm-12">
                        <div class="card-box">

                            <div class="row">
                                <div class="col-lg-6">
                                    <form class="form-horizontal" role="form">
                                        <div class="form-group">
                                            <label class="col-md-2 control-label">Title</label>
                                            <div class="col-md-10">
                                                <input type="text" class="form-control" ng-model="doc.title">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-md-2 control-label">Discount</label>
                                            <div class="col-md-10">
                                                <input type="text" class="form-control" ng-model="doc.discount">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-md-2 control-label">Category</label>
                                            <div class="col-md-10">
                                                <select class="form-control" required ng-model="doc.category" ng-init="doc.category" ng-options="category.name as category.name for category in categories">
                                                    <option value="" disabled selected>Select Category</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-md-2 control-label">Description</label>
                                            <div class="col-md-10">
                                                <div class="card-box">
                                                    <textarea id="elm1" name="area" ng-model="doc.description"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-md-2 control-label">Location</label>
                                            <div class="col-md-10">
                                                <input type="text" class="form-control" id="us3-address">
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-info waves-effect waves-light" ng-click="save()">Save</button>
                                    </form>
                                </div><!-- end col -->

                                <div class="col-lg-6">
                                    <form class="form-horizontal" role="form">
                                        <div class="form-group">
                                            <label class="col-md-2 control-label">Country</label>
                                            <div class="col-md-10">
                                                <input type="text" class="form-control" ng-model="doc.country">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-md-2 control-label">City</label>
                                            <div class="col-md-10">
                                                <input type="text" class="form-control" ng-model="doc.city">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-md-2 control-label">Airline</label>
                                            <div class="col-md-10">
                                                <select class="form-control" required ng-model="doc.airline" ng-init="doc.airline" ng-options="airline.airline as airline.airline for airline in airlines">
                                                    <option value="" disabled selected>Select Airline</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-md-2 control-label">Email</label>
                                            <div class="col-md-10">
                                                <input type="text" class="form-control" ng-model="doc.email">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-md-2 control-label">Phone / Country code</label>
                                            <div class="col-md-10">
                                                <input type="text" class="form-control" ng-model="doc.phone">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-md-2 control-label">Address</label>
                                            <div class="col-md-10">
                                                <input type="text" class="form-control" ng-model="doc.address">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="checkbox checkbox-primary">
                                                <input id="checkbox1" type="checkbox" ng-model="doc.disabled" ng-checked="doc.disabled">
                                                <label for="checkbox1">
                                                    Disabled
                                                </label>
                                            </div>
                                        </div>
                                        <!-- <div class="form-group">
                                        <label class="col-md-2 control-label">Expires</label>
                                        <div class="col-md-10">
                                        <input type="date" class="form-control" ng-model="doc.expires">
                                    </div>
                                </div> -->
                                <div layout="row" flex>
                                    <div flex>
                                        <label>Image</label>
                                        <input type="file" id="pinImage" file-model="pin.image" ng-file-select="onFileSelect($files)">
                                    </div>
                                    <div class="column" flex>
                                        <img ng-hide="imageSrc" ng-src="{{doc.image}}" class="img-thumbnail wd-pinImage" alt="put your image here">
                                        <img ng-show="imageSrc" ng-src="{{imageSrc}}" class="img-thumbnail wd-pinImage">
                                        <div class="alert alert-info" role="alert" ng-show="imageSrc">This is how the image will appear in app!</div>
                                    </div>
                                </div>
                            </div>

                            <br>

                            <div id="us3" class="col-sm-10" style="width: 100%; height: 400px;"></div>
                            <div class="clearfix">&nbsp;</div>
                            <div class="m-t-small">
                                <div class="col-sm-3">
                                    <input name="lat" class="form-control" id="us3-lat" ng-model="doc.latitude" style="display:none"/>
                                </div>
                                <div class="col-sm-3">
                                    <input name="long" class="form-control" id="us3-lon" ng-model="doc.longitude" style="display:none"/>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                        </form>

                    </div><!-- end row -->
                </div>
            </div><!-- end col -->

        </div> <!-- content -->

    </div>

    <!-- Bower Components -->
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/angular/angular.js"></script>
    <script src="assets/js/locationpicker.jquery.min.js"></script>
    <script type="text/javascript" src='http://maps.google.com/maps/api/js?libraries=places&key=AIzaSyAjwYmMnxjqHIw9NEnEOJwpeD6N2tNFtCM'></script>
    <script src="bower_components/lodash/lodash.js"></script>
    <script src="bower_components/ng-lodash/build/ng-lodash.min.js"></script>
    <script src="assets/plugins/tinymce/tinymce.min.js"></script>
    <script src="bower_components/sweetalert/dist/sweetalert.min.js"></script>
    <script type="text/javascript" src="bower_components/ng-sweet-alert/ng-sweet-alert.js"></script>
    <script type="text/javascript">
    $(document).ready(function () {
        if($("#elm1").length > 0){
            tinymce.init({
                selector: "textarea#elm1",
                theme: "modern",
                height: 300,
                plugins: [
                    "advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker",
                    "searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking",
                    "save table contextmenu directionality emoticons template paste textcolor"
                ],
                toolbar: "insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | l      ink image | print preview media fullpage | forecolor backcolor emoticons",
                style_formats: [
                    {title: 'Bold text', inline: 'b'},
                    {title: 'Red text', inline: 'span', styles: {color: '#ff0000'}},
                    {title: 'Red header', block: 'h1', styles: {color: '#ff0000'}},
                    {title: 'Example 1', inline: 'span', classes: 'example1'},
                    {title: 'Example 2', inline: 'span', classes: 'example2'},
                    {title: 'Table styles'},
                    {title: 'Table row 1', selector: 'tr', classes: 'tablerow1'}
                ]
            });
        }
    });

    var app = angular.module('myApp', ['ngLodash', 'ng-sweet-alert']);

    app.controller('myCtrl', function($scope, $http, SweetAlert) {

        $http.get('http://35.162.76.203:4142/api/v1/categories')
        .then(function(response) {
            $scope.categories = response.data;
        });

        $http.get('http://35.162.76.203:4142/api/v1/airlines')
        .then(function(response) {
            $scope.airlines = response.data;
        });

        $scope.save = function() {
            insertPin($scope.doc).then(function(response) {
                console.log(response);
                SweetAlert.success('Discount added', {
                    title: 'Good!'
                });
            });

            function insertPin(pin) {
                var d = new Date(pin.expires);
                var fd = new FormData();
                _.forEach(pin, function(data, key) {
                    fd.append(key, data);
                });
                return $http.post('http://35.162.76.203:4142/api/v1/pins', fd, {
                    transformRequest: angular.identity,
                    headers: {
                        'Content-Type': undefined
                    }
                });
            }
        }

        $scope.doc = {};

        $('#us3').locationpicker({
            radius: 0,
            inputBinding: {
                latitudeInput: $('#us3-lat'),
                longitudeInput: $('#us3-lon'),
                locationNameInput: $('#us3-address')
            },
            enableAutocomplete: true,
            onchanged: function (currentLocation, radius, isMarkerDropped) {
                $scope.latitude = currentLocation.latitude;
                $scope.longitude = currentLocation.longitude;
                $http.get('https://maps.googleapis.com/maps/api/geocode/json?latlng=' + $scope.latitude + ',' + $scope.longitude +'&key=AIzaSyCJD0xotwvjHL-eJjGNpEaT5iNTS3rS7GQ').then(function(response) {
                    $scope.doc.address = response.data.results[0].formatted_address;
                    response.data.results.map(function(item) {
                        if (item.types && item.types[0] === 'country') {
                            $scope.doc.country = item.formatted_address;
                        }

                        item.types.map(function(itemType) {
                            if (itemType === 'administrative_area_level_1') {
                                item.address_components.map(function(address) {
                                    address.types.map(function(city) {
                                        if (city === 'administrative_area_level_1') {
                                            $scope.doc.city = address.long_name;
                                        }
                                    });
                                });
                            }
                        });

                    });
                });
            }
        });
    });

    </script>

</body>
</html>
